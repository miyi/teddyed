# Migration `watch-20200109173316`

This migration has been generated by miyi at 1/9/2020, 5:33:31 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "lift"."new_Student" (
  "age" INTEGER    ,
  "event" TEXT    REFERENCES "Event"(id) ON DELETE SET NULL,
  "firstName" TEXT    ,
  "gender" TEXT NOT NULL DEFAULT 'MALE'  ,
  "id" TEXT NOT NULL   ,
  "lastName" TEXT    ,
  "user" TEXT NOT NULL   REFERENCES "User"(id) ON DELETE RESTRICT,
  PRIMARY KEY ("id")
);

INSERT INTO "new_Student" ("age","event","firstName","gender","id","user") SELECT "age","event","firstName","gender","id","user" from "Student"

DROP TABLE "lift"."Student";

ALTER TABLE "lift"."new_Student" RENAME TO "Student";

PRAGMA "lift".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "lift"."new_Instructor" (
  "age" INTEGER    ,
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "email" TEXT    ,
  "firstName" TEXT NOT NULL DEFAULT ''  ,
  "gender" TEXT    ,
  "id" TEXT NOT NULL   ,
  "lastName" TEXT NOT NULL DEFAULT ''  ,
  "listing" TEXT    REFERENCES "Listing"(id) ON DELETE SET NULL,
  "provider" TEXT    REFERENCES "Provider"(id) ON DELETE SET NULL,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

INSERT INTO "new_Instructor" ("age","createdAt","email","firstName","gender","id","lastName","listing","provider","updatedAt") SELECT "age","createdAt","email","firstName","gender","id","lastName","listing","provider","updatedAt" from "Instructor"

DROP TABLE "lift"."Instructor";

ALTER TABLE "lift"."new_Instructor" RENAME TO "Instructor";

CREATE UNIQUE INDEX "lift"."Instructor.email" ON "Instructor"("email")

PRAGMA "lift".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "lift"."new_Event" (
  "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  "eventState" TEXT NOT NULL DEFAULT 'ACTIVE'  ,
  "from" DATE    ,
  "id" TEXT NOT NULL   ,
  "listing" TEXT NOT NULL   REFERENCES "Listing"(id) ON DELETE RESTRICT,
  "provider" TEXT NOT NULL   REFERENCES "Provider"(id) ON DELETE RESTRICT,
  "to" DATE    ,
  "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00'  ,
  PRIMARY KEY ("id")
);

INSERT INTO "new_Event" ("createdAt","from","id","listing","provider","to","updatedAt") SELECT "createdAt","from","id","listing","provider","to","updatedAt" from "Event"

DROP TABLE "lift"."Event";

ALTER TABLE "lift"."new_Event" RENAME TO "Event";

PRAGMA "lift".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration watch-20191217205904..watch-20200109173316
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url      = "file:dev.db"
 }
 model User {
   id      String    @default(cuid()) @id
@@ -17,12 +17,12 @@
 model Student {
   id        String  @default(cuid()) @id
   firstName String?
-  LastName  String?
+  lastName  String?
   age       Int?
   gender    Gender  @default(MALE)
-  user      User @relation(name: "UserStudents")
+  user      User    @relation(name: "UserStudents")
 }
 model Post {
   id        String   @default(cuid()) @id
@@ -39,34 +39,35 @@
   email       String       @unique
   name        String?
   listings    Listing[]
   instructors Instructor[] @relation(name: "ProviderInstructors")
-  eventStore Event[] @relation(name: "ProviderEvents")
+  eventStore  Event[]      @relation(name: "ProviderEvents")
 }
 model Instructor {
-  id        String   @default(cuid()) @id
-  email String? @unique
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  firstName String
-  lastName  String
-  gender Gender
-  age Int
-  provider  Provider @relation(name: "ProviderInstructors")
-  eventStore Event[] @relation(name: "EventsInstructors")
+  id         String    @default(cuid()) @id
+  email      String?   @unique
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  firstName  String
+  lastName   String
+  gender     Gender?
+  age        Int?
+  provider   Provider? @relation(name: "ProviderInstructors")
+  eventStore Event[]   @relation(name: "EventsInstructors")
 }
 model Event {
-  id         String     @default(cuid()) @id
-  createdAt  DateTime   @default(now())
-  updatedAt  DateTime   @updatedAt
-  listing Listing @relation(name: "ListingEvents")
-  from DateTime
-  to DateTime 
-  provider   Provider @relation(name: "ProviderEvents")
+  id          String       @default(cuid()) @id
+  createdAt   DateTime     @default(now())
+  updatedAt   DateTime     @updatedAt
+  listing     Listing      @relation(name: "ListingEvents")
+  from        DateTime?
+  to          DateTime?
+  provider    Provider     @relation(name: "ProviderEvents")
   instructors Instructor[] @relation(name: "EventsInstructors")
-  students Student[] @relation(name: "EventsStudents")
+  students    Student[]    @relation(name: "EventsStudents")
+  eventState  EventState   @default(ACTIVE)
 }
 model Listing {
   id          String       @default(cuid()) @id
@@ -75,11 +76,17 @@
   title       String
   content     String?
   owner       Provider
   instructors Instructor[]
-  EventStore Event[] @relation(name: "ListingEvents")
+  EventStore  Event[]      @relation(name: "ListingEvents")
 }
+enum EventState {
+  ACTIVE
+  CANCELLED
+  FULFILLED
+}
+
 enum Gender {
-  MALEÂ 
+  MALE
   FEMALE
 }
```

## Photon Usage

You can use a specific Photon built for this migration (watch-20200109173316)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/watch-20200109173316'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
